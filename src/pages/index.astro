---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';

// Imports de Imágenes
import heroImg from '../assets/images/hero-stage-lights.webp';
import neonImg from '../assets/images/event-neon-cyber.webp';
import jazzImg from '../assets/images/event-jazz-night.webp';
import artImg from '../assets/images/event-digital-art.webp';
import bassImg from '../assets/images/event-bass-underground.webp';
import rockImg from '../assets/images/event-thunder-rock.webp';
import chillImg from '../assets/images/event-sunset-chill.webp';
import abstractImg from '../assets/images/event-abstract-minds.webp';
import popImg from '../assets/images/event-galactic-pop.webp';
import communityFooterImg from '../assets/images/community-footer.webp';

// Mock Events Data
const featuredEvents = [
  {
    title: "Neon Cyber Pulse",
    date: "15 OCT 2026",
    price: 150,
    image: neonImg
  },
  {
    title: "Astro Jazz Night",
    date: "22 NOV 2026",
    price: 45,
    image: jazzImg
  },
  {
    title: "Digital Art Expo",
    date: "05 DEC 2026",
    price: 30,
    image: artImg
  },
  {
    title: "Underground Bass",
    date: "12 JAN 2026",
    price: 60,
    image: bassImg
  },
  {
    title: "Thunder Rock",
    date: "20 FEB 2026",
    price: 55,
    image: rockImg
  },
  {
    title: "Sunset Chill",
    date: "14 MAR 2026",
    price: 35,
    image: chillImg
  },
  {
    title: "Abstract Minds",
    date: "01 APR 2026",
    price: 40,
    image: abstractImg
  },
  {
    title: "Galactic Pop",
    date: "10 MAY 2026",
    price: 90,
    image: popImg
  }
];
---

<Layout 
  title="Inicio | AstroTickets"
  description="Descubre los mejores eventos de música, tecnología y experiencias inolvidables con AstroTickets."
  ogTitle="AstroTickets - Tu puerta a eventos increíbles"
  ogDescription="Descubre los mejores eventos de música, tecnología y experiencias inolvidables con AstroTickets."
  ogImage="/social_preview.jpg"
>
  <!-- Hero Section with Parallax & Magnetic Effect -->
  <section class="relative h-screen flex items-center justify-center overflow-hidden" id="hero-section">
    <!-- Parallax Background -->
    <div class="absolute inset-0 z-0 bg-base-300" id="hero-bg">
        <Image 
            src={heroImg}
            alt="Hero Background"
            loading="eager"
            fetchpriority="high"
            class="absolute inset-0 w-full h-full object-cover opacity-20 mix-blend-overlay"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-base-100 via-transparent to-transparent"></div>
    </div>
    
    <div class="container mx-auto px-4 z-10 relative text-center flex flex-col items-center">
      <h1 class="text-6xl sm:text-7xl md:text-8xl lg:text-9xl font-black tracking-tighter leading-tight mb-6 md:mb-8">
        <span class="block mb-2 text-base-content hero-text-reveal px-8">ASTRO</span>
        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary hero-text-reveal px-20">TICKETS</span>
      </h1>

      <div class="max-w-3xl mx-auto mb-12">
        <p class="text-xl md:text-2xl text-base-content font-bold hero-subtext-reveal opacity-0 tracking-wide">
          Acceso exclusivo a las experiencias más inmersivas del mundo.
        </p>
      </div>

      <div class="hero-cta-wrapper opacity-0">
        <a href="/events" id="magnetic-btn" class="relative inline-flex items-center justify-center px-12 py-6 text-lg font-bold bg-primary text-primary-content transition-all duration-300 rounded-full shadow-2xl hover:shadow-primary/50">
            <span class="relative z-10 tracking-wide">Descubrir experiencias</span>
            <div class="absolute inset-0 rounded-full bg-primary/30 blur-md opacity-0 hover:opacity-100 transition-opacity duration-300"></div>
        </a>
      </div>
    </div>

    <!-- Scroll Down Indicator -->
    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 flex flex-col items-center gap-2 opacity-0 scroll-indicator" aria-hidden="true">
      <span class="text-xs font-bold uppercase tracking-widest text-base-content">Scroll</span>
      <div class="w-[1px] h-12 bg-base-content/20 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1/2 bg-primary animate-scroll-line"></div>
      </div>
    </div>
  </section>

  <!-- Marquee Text -->
  <div class="w-full bg-secondary text-secondary-content py-6 overflow-hidden z-20 relative rotate-1 scale-105 border-y-4 border-base-100" aria-hidden="true">
    <div class="whitespace-nowrap flex animate-marquee">
        <span class="text-4xl md:text-6xl font-black mx-8 uppercase italic">Conciertos • Festivales • Tecnología • Arte •</span>
        <span class="text-4xl md:text-6xl font-black mx-8 uppercase italic">Conciertos • Festivales • Tecnología • Arte •</span>
        <span class="text-4xl md:text-6xl font-black mx-8 uppercase italic">Conciertos • Festivales • Tecnología • Arte •</span>
    </div>
  </div>

  <!-- Horizontal Scroll Section (Pinned) -->
  <section id="horizontal-scroll-container" class="relative min-h-screen md:h-screen bg-base-100 overflow-hidden" role="region" aria-label="Eventos destacados">
    <div class="absolute top-0 left-0 w-full h-full hidden md:flex flex-col justify-center px-8 md:px-16 z-10 pointer-events-none">
        <h2 class="text-4xl md:text-6xl font-bold mb-4 text-base-content" aria-hidden="true">Destacados</h2>
    </div>
    
    <!-- The flexible container that moves left -->
    <div id="horizontal-track" class="flex flex-col md:flex-row items-center md:h-full px-4 md:pl-[10vw] md:pr-[10vw] py-12 md:py-0 gap-12 md:gap-24 w-full md:w-fit">
      
      <!-- Intro Card for the section -->
      <div class="flex-shrink-0 w-full md:w-[30vw] flex flex-col justify-center items-center md:items-start z-20 text-center md:text-left mobile-fade-in invisible opacity-0 translate-y-8 transition-all duration-700">
        <h2 class="text-5xl md:text-7xl font-black mb-6 leading-tight tracking-tight">Colección<br/><span class="text-primary">Premium</span></h2>
        <p class="text-xl text-base-content font-bold mb-8 max-w-md tracking-wide leading-relaxed">
          Experiencias excepcionales seleccionadas exclusivamente para los más exigentes.
        </p>
        <div class="flex gap-4 hidden md:flex">
            <div class="w-12 h-12 rounded-full border-2 border-primary/60 flex items-center justify-center hover:border-primary transition-colors">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
        </div>
      </div>

      <!-- Event Cards -->
      {featuredEvents.map((event, index) => (
        <div class="flex-shrink-0 w-full md:w-[40vw] lg:w-[30vw] group h-[50vh] md:h-[60vh] relative perspective-1000 mobile-fade-in invisible opacity-0 translate-y-8 transition-all duration-700" role="article" aria-label={`Evento destacado: ${event.title}, ${event.date}, desde ${event.price}€`}>
            <div class="w-full h-full relative transform transition-all duration-700 preserve-3d group-hover:rotate-y-12">
                <div class="absolute inset-0 bg-base-200 rounded-3xl overflow-hidden shadow-2xl">
                    <div class="w-full h-full overflow-hidden relative">
                        <Image
                            src={event.image} 
                            alt={event.title}
                            width={800} 
                            height={1000} 
                            class="card-inner-img object-cover w-[120%] h-full absolute left-[-10%] top-0 max-w-none transform transition-transform duration-1000 group-hover:scale-105"
                        />
                    </div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent group-hover:opacity-95 transition-opacity"></div>

                    <div class="absolute top-6 right-6 bg-black/60 backdrop-blur-md px-4 py-2 rounded-full border border-white/60 text-white font-mono text-sm font-bold">
                        {event.date}
                    </div>

                    <div class="absolute bottom-0 left-0 p-8 text-white w-full">
                        <h3 class="text-3xl md:text-4xl font-black mb-2 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 delay-100">{event.title}</h3>
                        <p class="text-xl font-light translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-500 delay-200">Desde {event.price}€</p>
                    </div>
                </div>
            </div>
            <div class="absolute -bottom-16 left-0 text-9xl font-black text-base-content -z-10 select-none hidden md:block">
                0{index + 1}
            </div>
        </div>
      ))}
      
      <!-- "See More" Card -->
      <div class="flex-shrink-0 w-full md:w-[30vw] h-[30vh] md:h-[60vh] flex items-center justify-center rounded-3xl mobile-fade-in invisible opacity-0 translate-y-8 transition-all duration-700 shadow-2xl bg-primary">
        <a href="/events" class="text-center group text-primary-content px-6">
            <span class="block text-5xl md:text-6xl font-black mb-4 group-hover:scale-110 transition-transform duration-300 tracking-tight leading-tight">Ver más</span>
            <span class="text-2xl font-bold">→</span>
        </a>
      </div>

    </div>
  </section>

  <!-- Big Image Section -->
  <section class="relative h-[80vh] overflow-hidden flex items-center justify-center clip-path-inset bg-black w-full">
    <div class="absolute inset-0 opacity-50">
         <Image src={communityFooterImg} alt="Community" width={1920} height={1080} class="w-full h-full object-cover parallax-img" />
    </div>
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative z-10 text-center text-white max-w-4xl px-4">
        <h2 class="text-5xl md:text-7xl lg:text-8xl font-black mb-8 mix-blend-difference" id="community-text">ÚNETE A LA<br/>COMUNIDAD</h2>
        <a href="/community" class="btn btn-lg btn-outline text-white border-white hover:bg-white hover:text-black rounded-full px-12 transition-all duration-300 transform hover:scale-110">
            Descubrir Más
        </a>
    </div>
  </section>

</Layout>

<style>
  /* 3D Utilities */
  .perspective-1000 { perspective: 1000px; }
  .preserve-3d { transform-style: preserve-3d; }
  .rotate-y-12 { transform: rotateY(10deg) rotateX(5deg); }

  /* Smooth Marquee */
  @keyframes marquee {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .animate-marquee {
    animation: marquee 30s linear infinite;
  }
  
  /* Scroll Line Animation */
  @keyframes scrollLine {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
  }
  .animate-scroll-line {
    animation: scrollLine 2s cubic-bezier(0.77, 0, 0.175, 1) infinite;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  function initAnimations() {
    // Only run animations if we're on the index page
    const isIndexPage = window.location.pathname === '/' || window.location.pathname === '/index.html';
    if (!isIndexPage) return;

    // Kill all existing ScrollTriggers to prevent conflicts
    ScrollTrigger.getAll().forEach(st => st.kill());

    gsap.registerPlugin(ScrollTrigger);

    // Check if hero elements exist before animating
    const heroTextElements = document.querySelectorAll(".hero-text-reveal");
    const heroSubtext = document.querySelector(".hero-subtext-reveal");
    const heroCta = document.querySelector(".hero-cta-wrapper");
    const scrollIndicator = document.querySelector(".scroll-indicator");

    if (heroTextElements.length === 0) return;

    // 1. HERO ANIMATIONS - Subtle and pleasant
    const heroTl = gsap.timeline({ defaults: { ease: "power3.out" } });

    // Set initial states explicitly
    gsap.set(".hero-text-reveal", { opacity: 0, y: 30 });
    if (heroSubtext) gsap.set(".hero-subtext-reveal", { opacity: 0, y: 20 });
    if (heroCta) gsap.set(".hero-cta-wrapper", { opacity: 0, y: 20 });
    if (scrollIndicator) gsap.set(".scroll-indicator", { opacity: 0 });

    heroTl
      .to(".hero-text-reveal", {
          opacity: 1,
          y: 0,
          duration: 1.2,
          stagger: 0.2,
          ease: "power3.out"
      });

    if (heroSubtext) {
      heroTl.to(".hero-subtext-reveal", {
          opacity: 1,
          y: 0,
          duration: 0.8
      }, "-=0.6");
    }

    if (heroCta) {
      heroTl.to(".hero-cta-wrapper", {
          opacity: 1,
          y: 0,
          duration: 0.8,
          ease: "back.out(1.2)"
      }, "-=0.4");
    }

    if (scrollIndicator) {
      heroTl.to(".scroll-indicator", {
          opacity: 1,
          duration: 0.6
      }, "-=0.3");
    }

    // Magnetic Button Effect
    const btn = document.getElementById("magnetic-btn");
    if(btn) {
      btn.addEventListener("mousemove", (e) => {
          const rect = btn.getBoundingClientRect();
          const x = e.clientX - rect.left - rect.width / 2;
          const y = e.clientY - rect.top - rect.height / 2;
          gsap.to(btn, { x: x * 0.3, y: y * 0.3, duration: 0.3 });
      });
      btn.addEventListener("mouseleave", () => {
          gsap.to(btn, { x: 0, y: 0, duration: 0.3, ease: "elastic.out(1, 0.3)" });
      });
    }

    // 2. HORIZONTAL SCROLL SECTION (The "Expert" part) with Mobile Protection
    const track = document.getElementById("horizontal-track");
    const container = document.getElementById("horizontal-scroll-container");

    if (track && container && isIndexPage) {
        ScrollTrigger.matchMedia({
            // Desktop Only
            "(min-width: 768px)": function() {
                const getScrollAmount = () => {
                  return -(track.scrollWidth - window.innerWidth);
                };

                // Main Horizontal Scroll
                gsap.to(track, {
                    x: getScrollAmount,
                    ease: "none",
                    scrollTrigger: {
                        trigger: container,
                        start: "top top",
                        end: () => `+=${getScrollAmount() * -1}`,
                        pin: true,
                        scrub: 1,
                        invalidateOnRefresh: true,
                    }
                });

                // Internal Parallax for Cards (Expert GSAP)
                // This selects all internal images and moves them slightly as we scroll horizontally
                gsap.utils.toArray(".card-inner-img").forEach((img: any) => {
                   gsap.to(img, {
                      xPercent: 15, // Move image to the right inside the container
                      ease: "none",
                      scrollTrigger: {
                          trigger: container,
                          start: "top top",
                          end: () => `+=${getScrollAmount() * -1}`,
                          scrub: true
                      }
                   });
                });
            },
            // Mobile cleanup (optional but good practice)
            "(max-width: 767px)": function() {
                // Ensure no pinned state remains if resizing
                ScrollTrigger.getAll().forEach(st => st.kill());
            }
        });
    }

    // 3. PARALLAX IMAGE FOOTER
    const parallaxImg = document.querySelector(".parallax-img");
    const communityText = document.querySelector("#community-text");
    const clipPathInset = document.querySelector(".clip-path-inset");

    if (parallaxImg && clipPathInset && isIndexPage) {
      gsap.from(".parallax-img", {
          scale: 1.2,
          y: 100,
          scrollTrigger: {
              trigger: ".clip-path-inset",
              start: "top bottom",
              end: "bottom top",
              scrub: true
          }
      });
    }

    if (communityText && clipPathInset && isIndexPage) {
      gsap.from("#community-text", {
          y: 50,
          opacity: 0,
          scrollTrigger: {
              trigger: ".clip-path-inset",
              start: "center bottom",
              toggleActions: "play none none reverse"
          }
      });
    }

    // 4. FADE-IN ANIMATIONS (Works on all screen sizes)
    const fadeElements = document.querySelectorAll('.mobile-fade-in');

    if (fadeElements.length > 0 && isIndexPage) {
      const fadeObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.remove('invisible', 'opacity-0', 'translate-y-8');
                fadeObserver.unobserve(entry.target);
            }
        });
      }, { threshold: 0.01, rootMargin: '50px' });

      fadeElements.forEach(el => {
        fadeObserver.observe(el);
        // Fallback: force visible after 2s if observer doesn't trigger
        setTimeout(() => {
          if (el.classList.contains('opacity-0')) {
            el.classList.remove('invisible', 'opacity-0', 'translate-y-8');
          }
        }, 2000);
      });
    }

    // Refresh ScrollTrigger after all animations are set up
    setTimeout(() => {
      ScrollTrigger.refresh();
    }, 100);
  }

  // Initialize on page load and after View Transitions
  initAnimations();
  document.addEventListener('astro:after-swap', () => {
    setTimeout(initAnimations, 50);
  });
  document.addEventListener('astro:page-load', () => {
    setTimeout(initAnimations, 50);
  });
</script>